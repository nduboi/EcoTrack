<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Mon Journal" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <% if flash.any? %>
      <div class="fixed top-4 right-4 z-[100] flex flex-col gap-2 w-full max-w-sm">
        <% flash.each do |type, message| %>
          <% alert_class = (type == 'alert' ? 'alert-error' : 'alert-success') %>
          <div class="alert <%= alert_class %> shadow-lg border-none animate-in fade-in slide-in-from-top-4 duration-300">
            <%= lucide_icon(type == 'alert' ? "alert-circle" : "check-circle", class: "size-5") %>
            <span class="text-sm font-medium"><%= message %></span>
            <button class="btn btn-ghost btn-xs btn-circle" onclick="this.parentElement.remove()">âœ•</button>
          </div>
        <% end %>
      </div>
    <% end %>

    <main>
      <div class="drawer">
        <input id="my-drawer-1" type="checkbox" class="drawer-toggle" />
        
        <div class="drawer-content flex flex-col bg-base-100 min-h-screen">
          <header class="navbar bg-base-100 border-b border-base-200 px-4 h-16 sticky top-0 z-10">
            <% if user_signed_in? %>
              <div class="flex-none">
                <label for="my-drawer-1" class="btn btn-ghost btn-square">
                  <%= lucide_icon("menu", class: "size-5") %>
                </label>
              </div>
            <% end %>
            
            <div class="flex-1 px-2">
              <h1 class="text-sm font-semibold text-base-content/60 uppercase tracking-wider">
                <%= user_signed_in? ? (content_for(:title) || "Tableau de bord") : "Eco Track" %>
              </h1>
            </div>

            <% if user_signed_in? %>
              <div class="flex gap-4 items-center">
                <button class="btn btn-ghost btn-circle btn-sm">
                  <%= lucide_icon("bell", class: "size-5") %>
                </button>
                <div class="avatar online shadow-sm">
                  <div class="w-9 rounded-full bg-base-200 flex items-center justify-center">
                    <% if current_user.avatar.present? %>
                      <img src="<%= current_user.avatar %>" />
                    <% else %>
                      <%= lucide_icon("user", class: "size-5") %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </header>

          <div class="p-6 lg:p-10 grow">
            <%= yield %>
          </div>
        </div>

        <% if user_signed_in? %>
          <%= render "layouts/sidebar" %>
        <% end %>
      </div>
    </main>
  </body>
</html>