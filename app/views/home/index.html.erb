<% content_for :title, "Tableau de bord" %>

<div class="flex flex-col gap-8">
  <%# Message de bienvenue %>
  <div>
    <h1 class="text-3xl font-black">Bonjour, <%= current_user.name.presence || current_user.email %> ! üëã</h1>
    <p class="text-base-content/60">Voici un aper√ßu de vos finances</p>
  </div>

  <%# Section des Stats %>
  <div class="stats stats-vertical lg:stats-horizontal shadow bg-base-100 border border-base-200 w-full">
    
    <%# Revenus %>
    <div class="stat">
      <div class="stat-figure text-success">
        <%= lucide_icon("trending-up", class: "size-8") %>
      </div>
      <div class="stat-title font-medium uppercase text-xs tracking-wider text-base-content/60">Revenus cumul√©s</div>
      <div class="stat-value text-success"><%= number_to_currency(@totalreceipe, unit: "‚Ç¨") %></div>
      <div class="stat-desc">Depuis le d√©but</div>
    </div>
    
    <%# D√©penses %>
    <div class="stat border-l border-base-200">
      <div class="stat-figure text-error">
        <%= lucide_icon("trending-down", class: "size-8") %>
      </div>
      <div class="stat-title font-medium uppercase text-xs tracking-wider text-base-content/60">D√©penses cumul√©es</div>
      <div class="stat-value text-error"><%= number_to_currency(@totalexpenses, unit: "‚Ç¨") %></div>
      <div class="stat-desc font-medium"><%= current_user.expenses.count %> transactions</div>
    </div>
    
    <%# Solde Net (Account) %>
    <div class="stat border-l border-base-200">
      <div class="stat-figure <%= @totalaccount >= 0 ? 'text-primary' : 'text-error' %>">
        <%= lucide_icon("wallet", class: "size-8") %>
      </div>
      <div class="stat-title font-medium uppercase text-xs tracking-wider text-base-content/60">Solde Actuel</div>
      <div class="stat-value <%= @totalaccount >= 0 ? 'text-primary' : 'text-error' %>">
        <%= number_to_currency(@totalaccount, unit: "‚Ç¨") %>
      </div>
      <div class="stat-desc font-semibold text-base-content/40">Wallet</div>
    </div>

  </div>

  <%# Boutons d'actions rapides %>
  <div class="flex flex-wrap gap-4">
    <%= link_to new_expense_path, class: "btn btn-outline btn-error gap-2" do %>
      <%= lucide_icon("minus-circle") %> Enregistrer une d√©pense
    <% end %>
    
    <%= link_to new_revenue_path, class: "btn btn-outline btn-success gap-2" do %>
      <%= lucide_icon("plus-circle") %> Enregistrer un revenu
    <% end %>
  </div>
  <h2 class="text-xl font-bold mt-8 mb-4">Mes Comptes</h2>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <% @accounts.each do |account| %>
      <div class="card border border-base-200 shadow-sm <%= 'opacity-50 grayscale' if account.hidden? %>">
        <div class="card-body p-4">
          <div class="flex justify-between items-center">
            <div class="flex items-center gap-2">
              <%= lucide_icon(account.account_type == "Esp√®ces" ? "wallet" : "landmark", class: "size-5") %>
              <h3 class="font-bold"><%= account.name %></h3>
            </div>
            <% if account.hidden? %>
              <div class="badge badge-ghost badge-xs">Masqu√©</div>
            <% end %>
          </div>
          <p class="text-2xl font-black mt-2">
            <%= number_to_currency(account.balance, unit: "‚Ç¨") %>
          </p>
        </div>
      </div>
    <% end %>
  </div>
</div>