<% content_for :title, "Revenus" %>

<div class="flex flex-col gap-8">
  <%# En-tête avec Stat %>
  <div class="flex flex-col md:flex-row justify-between items-end gap-4">
    <div class="stats shadow bg-success text-success-content w-full md:w-64">
      <div class="stat">
        <div class="stat-title text-success-content/60">Total des revenues</div>
        <div class="stat-value text-3xl">
          <%= number_to_currency(@revenues.sum(:amount), unit: "€") %>
        </div>
        <div class="stat-desc text-success-content/60 font-medium"><%= @revenues.count %> entrées</div>
      </div>
    </div>

    <%= link_to new_revenue_path, class: "btn btn-success text-white gap-2" do %>
      <%= lucide_icon("circle-plus", class: "size-5") %> Nouveau revenu
    <% end %>
  </div>

  <%# Tableau des revenus %>
  <div class="overflow-x-auto bg-base-100 rounded-xl border border-base-200 shadow-sm">
    <table class="table table-zebra">
      <thead>
        <tr class="bg-base-200/50">
          <th>Date</th>
          <th>Source</th>
          <th>Catégorie</th>
          <th class="text-right">Montant</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody id="revenues">
        <% if @revenues.any? %>
          <% @revenues.each do |revenue| %>
            <tr class="hover">
              <td class="text-xs opacity-70"><%= revenue.date&.strftime("%d/%m/%Y") %></td>
              <td class="font-medium"><%= revenue.name %></td>
              <td>
                <span class="badge badge-success badge-outline badge-sm">
                  <%= revenue.category&.nom || "Revenu" %>
                </span>
              </td>
              <td class="text-right font-bold text-success">+ <%= number_to_currency(revenue.amount, unit: "€") %></td>
              <td class="flex justify-center gap-2">
                <%= link_to revenue, class: "btn btn-ghost btn-xs btn-square" do %>
                  <%= lucide_icon("eye", class: "size-4") %>
                <% end %>
                <%= link_to edit_revenue_path(revenue), class: "btn btn-ghost btn-xs btn-square" do %>
                  <%= lucide_icon("pencil", class: "size-4") %>
                <% end %>
                <%= button_to revenue, method: :delete, class: "btn btn-ghost btn-xs btn-square text-error", data: { turbo_confirm: "Supprimer ce revenu ?" } do %>
                  <%= lucide_icon("trash-2", class: "size-4") %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr><td colspan="5" class="text-center py-10 opacity-50 italic">Aucun revenu enregistré.</td></tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>